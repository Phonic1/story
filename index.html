<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jack Changes the Game - Cyber Safe Story Adventure</title>
    
    <style>
        /* ===== UNIVERSAL FONT STACK ===== */
        * {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', 'Trebuchet MS', 'Arial Rounded MT Bold', Verdana, Arial, sans-serif;
        }

        /* ===== GLOBAL VARIABLES ===== */
        :root {
            --color-accent: #007aff;
            --color-correct: #34c759;
            --color-incorrect: #ff3b30;
            --color-text: #333;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --btn-border-radius: 20px;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }

        /* ===== MAIN APP CONTAINER ===== */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1d1d1f;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            min-height: 100vh;
        }

        #app-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; 
            width: 100%;
            padding-top: 20px;
        }

        /* ===== VIEW MANAGEMENT ===== */
        .view {
            display: none;
        }

        .view.active {
            display: flex;
        }

        /* ===== LANDING PAGE STYLES ===== */
        #landing-page {
            flex-direction: row;
            width: 1080px;
            height: 720px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-top: 10px;
        }

        .landing-sidebar {
            width: 280px;
            background: linear-gradient(180deg, #f5f5f7 0%, #e8e8ed 100%);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            border-right: 1px solid rgba(0,0,0,0.1);
        }

        .sidebar-button {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: left;
        }

        .sidebar-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .sidebar-button:active {
            transform: translateY(0);
        }

        .sidebar-button-icon {
            font-size: 28px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            flex-shrink: 0;
        }

        .sidebar-button-text {
            flex: 1;
        }

        .sidebar-button-subtitle {
            font-size: 12px;
            font-weight: 400;
            color: #86868b;
            margin-top: 4px;
        }

        .landing-main {
            flex: 1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            position: relative;
        }

        .landing-title {
            font-size: 52px;
            font-weight: 700;
            color: #9c27b0;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 4px 12px rgba(0,0,0,0.15);
            letter-spacing: -0.5px;
        }

        .landing-subtitle {
            font-size: 20px;
            font-weight: 500;
            color: #7b1fa2;
            text-align: center;
            margin-bottom: 50px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .start-reading-btn {
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .start-reading-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(0,0,0,0.3);
        }

        .start-reading-btn:active {
            transform: scale(0.98);
        }

        .info-banner {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: auto;
            font-size: 13px;
            color: #1d1d1f;
            line-height: 1.5;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .info-banner strong {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #1d1d1f;
        }

        /* ===== BOOK READER STYLES ===== */
        #book-reader {
            width: 1080px;
            height: 720px;
            margin-top: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            flex-direction: column;
        }

        #mute-toggle-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10; 
            font-size: 24px;
            padding: 0;
            background: rgba(255,255,255,0.95);
            color: #1d1d1f;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #mute-toggle-btn:hover {
            background: white;
            transform: scale(1.05);
        }

        #book-home-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            z-index: 25;
            font-size: 28px;
            padding: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            color: #9c27b0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: 60px;
            height: 60px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #book-home-btn:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        #book-home-btn:active {
            transform: scale(0.95);
        }

        #spreads-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .spread {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: none; 
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .active-spread { display: block; }

        .activity-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            border: none;
            border-radius: 50px;
            padding: 20px 45px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(52, 199, 89, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        .activity-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 12px 32px rgba(52, 199, 89, 0.5);
        }

        /* ===== CHAT BOARD STYLES ===== */
        #chat-board {
            flex-direction: column;
            width: 100%;
            height: 100vh;
            padding: 8px;
            overflow: hidden;
        }

        .phrase-display-container {
            background: white;
            border: 3px solid #4a5568;
            border-radius: 12px;
            padding: 10px;
            margin: 0 auto 8px;
            width: 100%;
            max-width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            display: flex;
            gap: 10px;
            align-items: stretch;
            height: 130px;
        }

        .phrase-display {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: flex-start;
            align-content: flex-start;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 10px;
            overflow: hidden;
        }

        .phrase-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 4px;
            padding: 8px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-height: 95px;
            height: fit-content;
        }

        .phrase-item img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .phrase-item .phrase-label {
            font-size: 0.7rem;
            color: #2d3748;
            text-align: center;
            font-weight: bold;
            line-height: 1.1;
            max-width: 80px;
            word-wrap: break-word;
        }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .speak-button {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .speak-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }

        .clear-button {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            flex: 1;
            align-content: start;
            overflow: hidden;
        }

        .aac-button {
            background: white;
            border: 3px solid #4a5568;
            border-radius: 15px;
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            max-height: calc((100vh - 190px) / 4);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .aac-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.3);
            border-color: #667eea;
        }

        .aac-button img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .aac-button .label {
            display: none;
        }

        .image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        /* ===== ACTIVITIES STYLES ===== */
        #activities {
            flex-direction: column;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
            align-items: center;
        }

        #activities body {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
        }

        .activities-container {
            width: 100%; 
            max-width: 1000px; 
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px; 
            box-shadow: var(--shadow); 
            overflow: hidden;
            display: flex; 
            flex-direction: column;
            position: relative;
        }

        .activities-header {
            background-color: #9c27b0; 
            color: white; 
            padding: 20px 30px; 
            text-align: center;
            border-bottom: 5px solid #7b1fa2;
        }

        .activities-header h1 { 
            font-size: 2.5rem; 
            font-weight: bold; 
            margin-bottom: 10px; 
        }

        #student-name-input {
            padding: 8px 12px; 
            font-size: 1rem;
            border-radius: 8px; 
            border: 1px solid #ccc; 
            width: 100%;
            max-width: 400px; 
            text-align: center;
        }

        .nav-bar { 
            display: flex; 
            justify-content: center; 
            background-color: #e1bee7; 
            padding: 10px; 
        }

        .act-nav-button {
            background-color: #1e90ff; 
            color: white; 
            border: 3px solid white;
            border-radius: var(--btn-border-radius); 
            padding: 10px 25px; 
            font-size: 1.2rem;
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s ease-in-out, background-color 0.2s ease; 
            margin: 0 10px;
        }

        .act-nav-button:hover { transform: scale(1.1); }
        .act-nav-button.active { background-color: #ff4500; transform: scale(1.05); }

        .content-area { padding: 30px; }
        .act-section { display: none; animation: fadeIn 0.5s ease-in-out; }
        .act-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .act-section h2 { color: #9c27b0; font-size: 2rem; margin-bottom: 20px; text-align: center; }
        .act-section p { line-height: 1.6; margin-bottom: 15px; font-size: 1.1rem; }

        .btn {
            color: white; 
            border: 3px solid white; 
            border-radius: var(--btn-border-radius);
            padding: 10px 25px; 
            font-size: 1.2rem; 
            font-weight: bold;
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s ease-in-out;
        }

        .btn:hover { transform: scale(1.1); }
        .section-footer { margin-top: 30px; text-align: center; display: flex; justify-content: center; gap: 15px; }
        .btn-main { background-color: #32cd32; }
        .btn-secondary { background-color: #1e90ff; }
        .btn-accent { background-color: #ffc107; }

        .prompt-card-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .prompt-card {
            background-color: #f3e5f5; 
            border-left: 5px solid var(--color-accent);
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .prompt-card h3 { color: #9c27b0; margin-bottom: 10px; }

        .flip-card-container { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin: 30px 0; }
        .flip-card { background-color: transparent; width: 150px; height: 150px; perspective: 1000px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.is-flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back {
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden;
            border-radius: 15px; 
            box-shadow: var(--shadow); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            text-align: center;
            font-size: 1.2rem; 
            font-weight: 700; 
            color: white; 
            padding: 10px;
        }
        .flip-card-front { background-color: #ff4500; font-size: 4rem; }
        .flip-card-back { background-color: #32cd32; transform: rotateY(180deg); }

        .extra-question {
            background-color: #9c27b0; 
            color: white; 
            border-radius: var(--border-radius);
            padding: 15px; 
            text-align: center; 
            margin: 20px auto 0 auto; 
            max-width: 500px;
            opacity: 0; 
            transform: translateY(20px); 
            transition: all 0.5s ease-in-out 0.3s;
        }
        .extra-question.visible { opacity: 1; transform: translateY(0); }

        .pledge-section { margin-top: 30px; text-align: center; }
        .pledge-input-area { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 15px; }
        .pledge-input {
            flex-grow: 1; 
            padding: 12px; 
            border: 2px solid #ccc;
            border-radius: 10px; 
            font-size: 1rem;
            color: var(--color-text);
        }
        .pledge-wall { margin-top: 25px; padding: 20px; min-height: 200px; background-color: #fffbe6; border: 2px solid #ffe8a8; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 15px; align-content: flex-start; }
        .pledge-note { width: 180px; height: 180px; padding: 15px; box-shadow: 5px 5px 10px rgba(0,0,0,0.1); font-size: 1rem; display: flex; justify-content: center; align-items: center; text-align: center; transition: transform 0.2s; }

        .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 20px; }
        #reset-btn { background-color: #32cd32; }
        #check-btn { background-color: #1e90ff; }
        #pdf-btn { background-color: #ff4500; }
        .drop-zones {
            display: grid; 
            grid-template-columns: 1fr 1fr;
            gap: 20px; 
            width: 100%;
            align-items: start;
        }
        .drop-box { background: rgba(255, 255, 255, 0.85); border: 2px dashed #ccc; border-radius: var(--border-radius); padding: 20px; min-height: 350px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .box-image-container { width: 100%; height: 120px; background-color: #f3e5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .box-image-container img { height: 100%; width: 100%; object-fit: cover; border-radius: 8px; }
        .box-header { font-size: 1.25rem; font-weight: bold; }
        #tile-container { height: 180px; display: flex; align-items: center; justify-content: center; }
        .tile { background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center; font-size: 1.2rem; line-height: 1.5; cursor: grab; transition: all 0.3s ease; user-select: none; position: relative; border: 2px solid transparent; }
        .tile.current-tile { min-width: 80%; max-width: 500px; min-height: 120px; display: flex; align-items: center; justify-content: center; transform: scale(1.1); border-color: #007aff; }
        .drop-box .tile { font-size: 1rem; width: 95%; padding: 10px; margin-bottom: 5px; }
        .tile.correct { border-color: var(--color-correct); }
        .tile.incorrect { border-color: var(--color-incorrect); }
        .read-aloud-btn { position: absolute; bottom: 10px; right: 10px; width: 36px; height: 36px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* ===== SHARED NAVIGATION BUTTONS ===== */
        #fullscreen-button, .home-btn {
            position: fixed;
            bottom: 30px;
            z-index: 20;
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            cursor: pointer;
            background: rgba(255,255,255,0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            backdrop-filter: blur(20px);
        }

        #fullscreen-button {
            left: 50%;
            transform: translateX(-50%);
        }

        .home-btn {
            left: 20px;
            width: 60px;
            height: 60px;
            padding: 0;
            border-radius: 50%;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #fullscreen-button:hover, .home-btn:hover { 
            transform: translateX(-50%) scale(1.05);
            background: white;
        }

        .home-btn:hover {
            transform: scale(1.1);
        }

        .nav-button {
            position: fixed; 
            top: 50%; 
            transform: translateY(-50%); 
            z-index: 20; 
            font-size: 32px; 
            color: #1d1d1f;
            border: none;
            border-radius: 50%; 
            width: 60px;
            height: 60px;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
        }

        .nav-button:hover { 
            transform: translateY(-50%) scale(1.1);
            background: white;
        }

        .nav-button:disabled {
            background: rgba(255,255,255,0.5);
            color: #86868b;
            cursor: not-allowed;
            transform: translateY(-50%); 
        }

        #prev-page-btn { left: 30px; }
        #next-page-btn { right: 30px; }

        /* Print styles for activities */
        .print-only, .print-only-pledge { display: none; }
        @media print {
            @page { margin: 0.5cm; size: A4 portrait; }
            body { 
                background: linear-gradient(135deg, #fff5f8 0%, #e3f2fd 50%, #f3e5f5 100%); 
                color: black; 
                font-size: 10pt;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .activities-container { display: none; }
            .print-only, .print-only-pledge { display: block; }
            
            .print-worksheet-header { 
                display: flex; 
                justify-content: space-between; 
                align-items: flex-start; 
                margin-bottom: 20px; 
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 15px;
                color: white;
                position: relative;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            
            .print-worksheet-header .title-block h1 { 
                font-size: 28pt; 
                color: white; 
                margin-bottom: 5px; 
                line-height: 1.1;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
                font-weight: bold;
            }
            
            .print-worksheet-header .info-block { 
                text-align: right; 
                font-size: 11pt; 
                white-space: nowrap;
                background: rgba(255,255,255,0.2);
                padding: 10px;
                border-radius: 10px;
                backdrop-filter: blur(10px);
            }
            
            #print-date, #print-pledge-date { 
                margin-bottom: 5px; 
                font-weight: bold;
            }
            
            #print-student-name, #print-pledge-student-name {
                font-weight: bold;
                font-size: 12pt;
            }

            .print-sorting-boxes { 
                display: grid; 
                grid-template-columns: 1fr 1fr; 
                gap: 1cm; 
                margin-top: 20px;
            }
            
            .print-box { 
                border: 4px solid #667eea; 
                border-radius: 20px; 
                padding: 15px; 
                text-align: center; 
                min-height: 250px; 
                page-break-inside: avoid;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                position: relative;
            }
            
            .print-box::before {
                content: "‚ú®";
                position: absolute;
                top: 5px;
                left: 10px;
                font-size: 14pt;
            }
            
            .print-box::after {
                content: "‚ú®";
                position: absolute;
                top: 5px;
                right: 10px;
                font-size: 14pt;
            }
            
            .print-box h2 { 
                font-size: 18pt; 
                margin-bottom: 15px; 
                color: #667eea;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
                padding: 10px;
                background: linear-gradient(135deg, #fff5f8 0%, #e8eaf6 100%);
                border-radius: 10px;
            }
            
            .print-box img { 
                max-width: 100%; 
                height: 100px; 
                object-fit: contain; 
                margin-bottom: 15px;
                border: 3px solid #e8eaf6;
                border-radius: 15px;
                padding: 10px;
                background: white;
            }
            
            .print-tile { 
                border: 2px solid #667eea; 
                border-radius: 12px; 
                padding: 10px; 
                text-align: center; 
                font-size: 10pt; 
                line-height: 1.4; 
                margin: 8px auto; 
                width: 95%; 
                background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                font-weight: 500;
            }
            
            .print-tile.correct { 
                background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                border-color: #28a745;
                border-width: 3px;
                font-weight: bold;
            }
            
            .print-tile.correct::before {
                content: "‚úì ";
                color: #28a745;
                font-size: 14pt;
                font-weight: bold;
            }
            
            .print-tile.incorrect { 
                background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
                border-color: #dc3545;
                border-width: 3px;
                font-weight: bold;
            }
            
            .print-tile.incorrect::before {
                content: "‚úó ";
                color: #dc3545;
                font-size: 14pt;
                font-weight: bold;
            }
            
            #print-pledge-wall { 
                page-break-inside: avoid; 
                margin-top: 30px; 
                display: flex; 
                flex-wrap: wrap; 
                gap: 15px; 
                justify-content: center;
                padding: 20px;
                background: linear-gradient(135deg, #fffacd 0%, #ffeb3b 20%, #fffacd 100%);
                border-radius: 15px;
                border: 4px dashed #fdd835;
            }
            
            .print-pledge-note {
                width: 160px; 
                height: 160px; 
                padding: 15px; 
                border: 3px solid #333;
                box-shadow: 5px 5px 10px rgba(0,0,0,0.2); 
                font-size: 10pt; 
                display: flex;
                justify-content: center; 
                align-items: center; 
                text-align: center; 
                line-height: 1.4;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-weight: 600;
                position: relative;
            }
            
            .print-pledge-note::before {
                content: "üìå";
                position: absolute;
                top: -5px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 16pt;
            }
        }
    </style>
</head>
<body>
    
    <!-- Print-only worksheets -->
    <div class="print-only" id="print-sorting-worksheet">
        <header class="print-worksheet-header">
            <div class="title-block"><h1>Friend Sorting Activity</h1></div>
            <div class="info-block"><div id="print-date"></div><div id="print-student-name"></div></div>
        </header>
        <main>
            <div class="print-sorting-boxes">
                <div class="print-box">
                    <img src="in-person-friend.jpg" alt="In-person Friends">
                    <h2>In-person Friend</h2><div id="print-in-person-box-content"></div>
                </div>
                <div class="print-box">
                    <img src="online-friend.jpg" alt="Online Friend">
                    <h2>Online Friend</h2><div id="print-online-box-content"></div>
                </div>
            </div>
        </main>
    </div>

    <div class="print-only-pledge" id="print-pledge-worksheet">
        <header class="print-worksheet-header">
            <div class="title-block"><h1>My Cyber Safe Pledge Wall</h1></div>
            <div class="info-block"><div id="print-pledge-date"></div><div id="print-pledge-student-name"></div></div>
        </header>
        <main><div id="print-pledge-wall"></div></main>
    </div>

    <div id="app-container">
        <!-- ===== LANDING PAGE ===== -->
        <div id="landing-page" class="view active">
            <div class="landing-sidebar">
                <button class="sidebar-button" onclick="showView('activities')">
                    <div class="sidebar-button-icon">üìù</div>
                    <div class="sidebar-button-text">
                        <div>View Activities</div>
                        <div class="sidebar-button-subtitle">Interactive exercises</div>
                    </div>
                </button>
                
                <button class="sidebar-button" onclick="showView('chat-board')">
                    <div class="sidebar-button-icon">üí¨</div>
                    <div class="sidebar-button-text">
                        <div>Chat Board</div>
                        <div class="sidebar-button-subtitle">AAC communication tool</div>
                    </div>
                </button>

                <div class="info-banner">
                    <strong>For Teachers:</strong>
                    As of Dec 10, 2025, Australian students under 16 are restricted from major social media platforms. Use these resources to discuss cyber safety.
                </div>
            </div>

            <div class="landing-main" style="background-image: url('frontcover.jpg');">
                <h1 class="landing-title">Jack Changes the Game</h1>
                <p class="landing-subtitle">An Interactive Adventure for Students</p>
                <button class="start-reading-btn" onclick="startReading()">Begin Reading ‚Üí</button>
            </div>
        </div>

        <!-- ===== BOOK READER ===== -->
        <div id="book-reader" class="view">
            <button id="mute-toggle-btn">üîä</button>
            <div id="spreads-container"></div>
        </div>

        <!-- ===== CHAT BOARD ===== -->
        <div id="chat-board" class="view">
            <div class="phrase-display-container">
                <div class="phrase-display" id="phraseDisplay"></div>
                <div class="control-buttons">
                    <button class="speak-button" onclick="speakPhrase()">üîä Speak</button>
                    <button class="clear-button" onclick="clearPhrase()">‚úñ Clear</button>
                </div>
            </div>
            <div class="button-grid" id="buttonGrid"></div>
        </div>

        <!-- ===== ACTIVITIES ===== -->
        <div id="activities" class="view">
            <div class="activities-container">
                <header class="activities-header">
                    <h1>Cyber Safe Story Adventure</h1>
                    <div class="name-input-container">
                        <input type="text" id="student-name-input" placeholder="Enter your name for the worksheet...">
                    </div>
                </header>

                <nav class="nav-bar">
                    <button class="act-nav-button active" data-section="past">1. The Past</button>
                    <button class="act-nav-button" data-section="present">2. The Present</button>
                    <button class="act-nav-button" data-section="future">3. The Future</button>
                </nav>

                <main class="content-area">
                    <section id="past" class="act-section active">
                        <h2>Part 1: The Past - What happened?</h2>
                        <div class="prompt-card-container">
                            <div class="prompt-card"><h3>Let's Talk About Jack</h3><p>What happened to Jack in the story? Why did he feel worried when talking to 'Footy Boy'?</p></div>
                            <div class="prompt-card"><h3>Talking in Games</h3><p>Jack plays online games. Do you ever talk to other players during an online game?</p></div>
                            <div class="prompt-card"><h3>Personal Questions</h3><p>Has an online friend ever asked you questions about your school, where you live, or your age?</p></div>
                            <div class="prompt-card"><h3>Your Story</h3><p>Has anything like Jack's story ever happened to you or someone you know?</p></div>
                        </div>
                        <div class="section-footer"><button class="btn btn-main" onclick="showActivitySection('present')">Time for an Activity!</button></div>
                    </section>

                    <section id="present" class="act-section">
                        <h2>Part 2: The Present - Friend Sorting!</h2>
                        <p>Let's practice telling the difference between an in-person friend and an online friend. Sort the cards into the correct box!</p>
                        <div class="controls">
                            <button id="reset-btn" class="btn btn-main">Reset Game</button>
                            <button id="check-btn" class="btn btn-secondary">Check Answers</button>
                            <button id="pdf-btn" class="btn" style="background-color: #ff4500;">Save as Worksheet</button>
                            <button class="btn btn-accent" onclick="showActivitySection('future')">Let's Plan for the Future!</button>
                        </div>
                        <div class="drop-zones">
                            <div id="in-person-box" class="drop-box" data-category="in-person">
                                <div class="box-image-container"><img src="in-person-friend.jpg" alt="In-person friends"></div>
                                <div class="box-header">In-person Friend <span class="count" id="in-person-count">(0)</span></div>
                            </div>
                            <div id="online-box" class="drop-box" data-category="online">
                                <div class="box-image-container"><img src="online-friend.jpg" alt="Online friend avatar"></div>
                                <div class="box-header">Online Friend <span class="count" id="online-count">(0)</span></div>
                            </div>
                        </div>
                        <div id="tile-container"></div>
                    </section>

                    <section id="future" class="act-section">
                        <h2>Part 3: The Future - What will we do?</h2>
                        <p>Planning what to do is the best way to stay safe! If something like Jack's story happens, it's important to know who can help.</p>
                        <h3>Who are our trusted adults?</h3>
                        <div class="flip-card-container">
                            <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front">?</div><div class="flip-card-back">Parents / Carers</div></div></div>
                            <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front">?</div><div class="flip-card-back">Teacher</div></div></div>
                            <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front">?</div><div class="flip-card-back">Grandparents</div></div></div>
                            <div class="flip-card" id="police-officer-card"><div class="flip-card-inner"><div class="flip-card-front">?</div><div class="flip-card-back">Police Officer</div></div></div>
                        </div>
                        <p class="extra-question" id="extra-question-prompt">Can you think of any more trusted adults?</p>

                        <div class="pledge-section">
                            <h3>Create a Cyber Safe Pledge Wall!</h3>
                            <p>Let's make a promise to stay safe online. Finish the sentence below and add your pledge to our class wall.</p>
                            <div class="pledge-input-area">
                                <span>I will stay safe online by...</span>
                                <input type="text" id="pledge-input" class="pledge-input" placeholder="...not sharing my address." maxlength="100">
                                <button id="add-pledge-btn" class="btn btn-secondary">Add to Wall!</button>
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <button id="save-pledge-btn" class="btn btn-accent">Save as Worksheet</button>
                            </div>
                            <div id="pledge-wall" class="pledge-wall"></div>
                        </div>
                        <div class="section-footer">
                            <button class="btn btn-main" onclick="showActivitySection('past')">Start Over</button>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <button id="book-home-btn" onclick="showView('landing-page')">üè†</button>
        <button id="prev-page-btn" class="nav-button" style="display:none;">‚óÄ</button> 
        <button id="next-page-btn" class="nav-button" style="display:none;">‚ñ∂</button>
        <button id="fullscreen-button" style="display:none;">Toggle Fullscreen</button>
        <button class="home-btn" onclick="showView('landing-page')" style="display:none;">üè†</button>
    </div>

    <script>
        // ===== GLOBAL STATE =====
        let currentView = 'landing-page';
        let currentSpreadIndex = 0;
        let isMuted = false;
        let currentAudio = new Audio();
        let audioPlaylist = [];
        let currentTrackIndex = 0;

        // ===== AUDIO MAP FOR BOOK =====
        const audioMap = {
            4: ['p4.mp3'], 5: ['p5.mp3'], 6: ['p6.mp3'], 7: ['p7.mp3'],
            8: ['p8.mp3'], 9: ['p9.mp3'], 10: ['p10.mp3'],
            11: ['p11a.mp3', 'p11b.mp3', 'p11c.mp3'],
            12: ['p12.mp3'], 13: ['p13.mp3'], 14: ['p14.mp3'], 15: ['p15.mp3'],
            16: ['p16.mp3'], 17: ['p17.mp3'],
            18: ['p18a.mp3', 'p18b.mp3'],
            19: ['p19.mp3'], 20: ['p20.mp3'], 21: ['p21.mp3'], 22: ['p22.mp3'],
            23: ['p23a.mp3', 'p23b.mp3', 'p23c.mp3'],
            24: ['p24&25.mp3'], 25: [], 
            26: ['p26.mp3'], 27: ['p27.mp3'], 28: ['p28.mp3'], 29: ['p29.mp3'],
            30: ['p30.mp3'], 31: []
        };

        // ===== VIEW MANAGEMENT =====
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            currentView = viewId;

            // Hide all nav buttons
            document.getElementById('prev-page-btn').style.display = 'none';
            document.getElementById('next-page-btn').style.display = 'none';
            document.getElementById('fullscreen-button').style.display = 'none';
            document.getElementById('book-home-btn').style.display = 'none';
            document.querySelector('.home-btn').style.display = 'none';

            // Show appropriate buttons
            if (viewId === 'book-reader') {
                document.getElementById('prev-page-btn').style.display = 'block';
                document.getElementById('next-page-btn').style.display = 'block';
                document.getElementById('fullscreen-button').style.display = 'block';
                document.getElementById('book-home-btn').style.display = 'flex';
            } else if (viewId !== 'landing-page') {
                document.querySelector('.home-btn').style.display = 'flex';
            }

            // Initialize view if needed
            if (viewId === 'chat-board' && !chatBoardInitialized) {
                initChatBoard();
            }
            if (viewId === 'activities' && !activitiesInitialized) {
                initActivities();
            }
        }

        // ===== BOOK READER FUNCTIONS =====
        function createSpreads() {
            const container = document.getElementById('spreads-container');
            const totalSpreads = 14;
            
            for (let i = 0; i < totalSpreads; i++) {
                const startPage = 4 + (i * 2);
                const endPage = startPage + 1;
                const spreadDiv = document.createElement('div');
                spreadDiv.className = 'spread';
                spreadDiv.style.backgroundImage = `url('spread${startPage}-${endPage}.jpg')`;
                container.appendChild(spreadDiv);
            }

            // Add activity button to last spread
            const spreads = document.querySelectorAll('.spread');
            const lastSpread = spreads[spreads.length - 1];
            const activityButton = document.createElement('button');
            activityButton.className = 'activity-button';
            activityButton.textContent = 'Start Activities ‚Üí';
            activityButton.onclick = () => showView('activities');
            lastSpread.appendChild(activityButton);
        }

        function startReading() {
            currentSpreadIndex = 0;
            showView('book-reader');
            showSpread(currentSpreadIndex);
        }

        function showSpread(index) {
            const spreads = document.querySelectorAll('.spread');
            spreads.forEach(spread => spread.classList.remove('active-spread'));
            if (spreads[index]) { spreads[index].classList.add('active-spread'); }
            
            document.getElementById('prev-page-btn').disabled = (index === 0);
            document.getElementById('next-page-btn').disabled = (index === spreads.length - 1);
            playAudioForSpread(index);
        }

        function playAudioForSpread(spreadIndex) {
            stopCurrentAudio();
            const leftPage = 4 + (spreadIndex * 2);
            const rightPage = leftPage + 1;
            const leftAudio = audioMap[leftPage] || [];
            const rightAudio = audioMap[rightPage] || [];
            audioPlaylist = [...new Set([...leftAudio, ...rightAudio])];
            if (audioPlaylist.length > 0) { playNextInPlaylist(); }
        }

        function stopCurrentAudio() {
            if (!currentAudio.paused) { currentAudio.pause(); currentAudio.currentTime = 0; }
            audioPlaylist = []; 
            currentTrackIndex = 0;
        }

        function playNextInPlaylist() {
            if (currentTrackIndex < audioPlaylist.length) {
                const track = audioPlaylist[currentTrackIndex];
                currentAudio.src = track;
                currentAudio.muted = isMuted; 
                currentAudio.play().catch(e => console.error("Audio playback failed:", e));
            }
        }

        // ===== CHAT BOARD FUNCTIONS =====
        let chatBoardInitialized = false;
        let currentPhrase = [];
        const audioElements = {};

        const chatButtons = [
            { audio: 'i.mp3', image: 'i.png', label: 'i' },
            { audio: 'look, see, find.mp3', image: 'look, see, find.png', label: 'look, see, find' },
            { audio: 'illegal.mp3', image: 'illegal.png', label: 'illegal' },
            { audio: 'internet.mp3', image: 'internet.png', label: 'internet' },
            { audio: 'more.mp3', image: 'more.png', label: 'more' },
            { audio: 'you.mp3', image: 'you.png', label: 'you' },
            { audio: 'send.mp3', image: 'send.png', label: 'send' },
            { audio: 'public.mp3', image: 'public.png', label: 'public' },
            { audio: 'snapchat.mp3', image: 'snapchat.png', label: 'snapchat' },
            { audio: 'finish.mp3', image: 'finish.png', label: 'finish' },
            { audio: 'trusted adult.mp3', image: 'trusted adult.png', label: 'trusted adult' },
            { audio: 'cyber bullying.mp3', image: 'cyber bullying.png', label: 'cyber bullying' },
            { audio: 'private.mp3', image: 'private.png', label: 'private' },
            { audio: 'facebook.mp3', image: 'facebook.png', label: 'facebook' },
            { audio: 'help.mp3', image: 'help.png', label: 'help' },
            { audio: 'not.mp3', image: 'not.png', label: 'not' },
            { audio: 'talk.mp3', image: 'talk.png', label: 'talk' },
            { audio: 'nudes.mp3', image: 'nudes.png', label: 'nudes' },
            { audio: 'instagram.mp3', image: 'instagram.png', label: 'instagram' },
            { audio: 'something different.mp3', image: 'something different.png', label: 'something different' }
        ];

        function initChatBoard() {
            const buttonGrid = document.getElementById('buttonGrid');
            chatButtons.forEach(buttonData => {
                const audio = new Audio(buttonData.audio);
                audio.preload = 'auto';
                audioElements[buttonData.audio] = audio;

                const button = document.createElement('div');
                button.className = 'aac-button';
                button.onclick = () => addToPhrase(buttonData);

                const img = document.createElement('img');
                img.src = buttonData.image;
                img.alt = buttonData.label;
                img.onerror = function() {
                    this.style.display = 'none';
                    const placeholder = document.createElement('div');
                    placeholder.className = 'image-placeholder';
                    placeholder.textContent = buttonData.label.charAt(0).toUpperCase();
                    button.insertBefore(placeholder, button.firstChild);
                };

                button.appendChild(img);
                buttonGrid.appendChild(button);
            });
            chatBoardInitialized = true;
        }

        function addToPhrase(buttonData) {
            currentPhrase.push(buttonData);
            updatePhraseDisplay();
            playAudio(buttonData.audio);
        }

        function playAudio(audioFile) {
            const audio = audioElements[audioFile];
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(error => console.error('Error playing audio:', error));
            }
        }

        function updatePhraseDisplay() {
            const phraseDisplay = document.getElementById('phraseDisplay');
            phraseDisplay.innerHTML = '';

            currentPhrase.forEach(item => {
                const phraseItem = document.createElement('div');
                phraseItem.className = 'phrase-item';

                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.label;

                const label = document.createElement('div');
                label.className = 'phrase-label';
                label.textContent = item.label;

                phraseItem.appendChild(img);
                phraseItem.appendChild(label);
                phraseDisplay.appendChild(phraseItem);
            });
        }

        async function speakPhrase() {
            if (currentPhrase.length === 0) return;

            for (let i = 0; i < currentPhrase.length; i++) {
                const audio = audioElements[currentPhrase[i].audio];
                if (audio) {
                    audio.currentTime = 0;
                    await audio.play().catch(error => console.error('Error playing audio:', error));
                    await new Promise(resolve => { audio.onended = resolve; });
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
            }
        }

        function clearPhrase() {
            currentPhrase = [];
            updatePhraseDisplay();
        }

        // ===== ACTIVITIES FUNCTIONS =====
        let activitiesInitialized = false;
        const sentences = [
            { text: "We sit next to each other in class.", category: "in-person" },
            { text: "I see them on the playground at recess.", category: "in-person" },
            { text: "We walk home from school together.", category: "in-person" },
            { text: "My teacher knows who they are.", category: "in-person" },
            { text: "I have been to their house for a playdate.", category: "in-person" },
            { text: "I only know them by their username.", category: "online" },
            { text: "They use a cartoon picture instead of their real photo.", category: "online" },
            { text: "I met them while playing a game online.", category: "online" },
            { text: "We only talk through messages on an app.", category: "online" },
            { text: "They asked me what school I go to.", category: "online" }
        ];

        let currentSentences = [];
        let currentSortIndex = 0;
        let draggedTile = null;

        function initActivities() {
            document.querySelectorAll('.act-nav-button').forEach(button => {
                button.addEventListener('click', () => {
                    const section = button.dataset.section;
                    showActivitySection(section);
                });
            });

            document.getElementById('reset-btn').addEventListener('click', startSortingGame);
            document.getElementById('check-btn').addEventListener('click', checkAllAnswers);
            
            document.getElementById('pdf-btn').addEventListener('click', () => {
                const studentNameInput = document.getElementById('student-name-input');
                document.getElementById('print-student-name').textContent = `Name: ${studentNameInput.value.trim() || '____________________'}`;
                document.getElementById('print-date').textContent = `Date: ${new Date().toLocaleDateString()}`;

                const printInPersonContainer = document.getElementById('print-in-person-box-content');
                const printOnlineContainer = document.getElementById('print-online-box-content');
                printInPersonContainer.innerHTML = '';
                printOnlineContainer.innerHTML = '';

                document.querySelectorAll('#in-person-box .tile').forEach(liveTile => {
                    const printTile = document.createElement('div');
                    printTile.className = 'print-tile';
                    if (liveTile.classList.contains('correct')) printTile.classList.add('correct');
                    if (liveTile.classList.contains('incorrect')) printTile.classList.add('incorrect');
                    printTile.textContent = liveTile.querySelector('span').textContent;
                    printInPersonContainer.appendChild(printTile);
                });
                
                document.querySelectorAll('#online-box .tile').forEach(liveTile => {
                    const printTile = document.createElement('div');
                    printTile.className = 'print-tile';
                    if (liveTile.classList.contains('correct')) printTile.classList.add('correct');
                    if (liveTile.classList.contains('incorrect')) printTile.classList.add('incorrect');
                    printTile.textContent = liveTile.querySelector('span').textContent;
                    printOnlineContainer.appendChild(printTile);
                });
                
                document.getElementById('print-pledge-worksheet').style.display = 'none';
                document.getElementById('print-sorting-worksheet').style.display = 'block';
                window.print();
                document.getElementById('print-pledge-worksheet').style.display = '';
                document.getElementById('print-sorting-worksheet').style.display = '';
            });

            document.querySelectorAll('.flip-card').forEach(card => {
                card.addEventListener('click', () => card.classList.toggle('is-flipped'));
            });

            document.getElementById('police-officer-card').addEventListener('click', () => {
                setTimeout(() => {
                    document.getElementById('extra-question-prompt').classList.add('visible');
                }, 100);
            });

            document.getElementById('add-pledge-btn').addEventListener('click', addPledge);
            document.getElementById('pledge-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addPledge();
            });
            
            document.getElementById('save-pledge-btn').addEventListener('click', () => {
                const studentNameInput = document.getElementById('student-name-input');
                document.getElementById('print-pledge-student-name').textContent = `Name: ${studentNameInput.value.trim() || '____________________'}`;
                document.getElementById('print-pledge-date').textContent = `Date: ${new Date().toLocaleDateString()}`;

                const printPledgeWall = document.getElementById('print-pledge-wall');
                printPledgeWall.innerHTML = '';
                
                document.querySelectorAll('#pledge-wall .pledge-note').forEach(liveNote => {
                    const printNote = document.createElement('div');
                    printNote.className = 'print-pledge-note';
                    printNote.textContent = liveNote.textContent;
                    printNote.style.backgroundColor = liveNote.style.backgroundColor;
                    printNote.style.transform = liveNote.style.transform;
                    printPledgeWall.appendChild(printNote);
                });

                document.getElementById('print-sorting-worksheet').style.display = 'none';
                document.getElementById('print-pledge-worksheet').style.display = 'block';
                window.print();
                document.getElementById('print-sorting-worksheet').style.display = '';
                document.getElementById('print-pledge-worksheet').style.display = '';
            });

            [document.getElementById('in-person-box'), document.getElementById('online-box')].forEach(box => {
                box.addEventListener('click', () => {
                    const ct = document.querySelector('.current-tile');
                    if(ct) moveTileToBox(ct, box);
                });
                box.addEventListener('dragover', (e) => e.preventDefault());
                box.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedTile) moveTileToBox(draggedTile, box);
                });
            });

            activitiesInitialized = true;
        }

        function showActivitySection(sectionId) {
            document.querySelectorAll('.act-section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.act-nav-button').forEach(button => {
                button.classList.toggle('active', button.dataset.section === sectionId);
            });

            if (sectionId === 'present') {
                startSortingGame();
            } else if (sectionId === 'future') {
                document.querySelectorAll('.flip-card').forEach(card => card.classList.remove('is-flipped'));
                document.getElementById('extra-question-prompt').classList.remove('visible');
            }
        }

        function startSortingGame() {
            currentSortIndex = 0;
            currentSentences = [...sentences];
            shuffleArray(currentSentences);
            document.querySelectorAll('.drop-box .tile').forEach(tile => tile.remove());
            showNextTile();
            updateCounts();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showNextTile() {
            const tileContainer = document.getElementById('tile-container');
            tileContainer.innerHTML = '';
            
            if (currentSortIndex >= currentSentences.length) return;

            const sentence = currentSentences[currentSortIndex];
            const tile = document.createElement('div');
            tile.className = 'tile current-tile';
            tile.draggable = true;
            tile.dataset.category = sentence.category;
            tile.innerHTML = `<span>${sentence.text}</span>`;
            
            tile.addEventListener('dragstart', (e) => { draggedTile = e.target; });
            tile.addEventListener('dragend', () => { draggedTile = null; });
            
            tileContainer.appendChild(tile);
        }

        function moveTileToBox(tile, targetBox) {
            if (!tile || !targetBox) return;
            tile.classList.remove('current-tile', 'correct', 'incorrect');
            targetBox.appendChild(tile);
            updateCounts();
            currentSortIndex++;
            showNextTile();
        }

        function updateCounts() {
            document.getElementById('in-person-count').textContent = 
                `(${document.getElementById('in-person-box').querySelectorAll('.tile').length})`;
            document.getElementById('online-count').textContent = 
                `(${document.getElementById('online-box').querySelectorAll('.tile').length})`;
        }

        function checkAllAnswers() {
            let correctCount = 0;
            const allSortedTiles = document.querySelectorAll('.drop-box .tile');
            if (allSortedTiles.length === 0) { 
                alert('Sort some tiles first!'); 
                return; 
            }
            
            allSortedTiles.forEach(tile => {
                const isCorrect = tile.parentElement.dataset.category === tile.dataset.category;
                tile.classList.toggle('correct', isCorrect);
                tile.classList.toggle('incorrect', !isCorrect);
                if (isCorrect) correctCount++;
            });
            
            alert(`You got ${correctCount} out of ${allSortedTiles.length} correct so far.`);
        }

        function addPledge() {
            const pledgeInput = document.getElementById('pledge-input');
            const pledgeText = pledgeInput.value.trim();
            if (pledgeText === "") { 
                alert("Please write your pledge first!"); 
                return; 
            }

            const noteColors = ['#fdffb6', '#ffc6d9', '#a0c4ff', '#caffbf'];
            const note = document.createElement('div');
            note.className = 'pledge-note';
            note.textContent = "I will stay safe online by " + pledgeText;
            note.style.backgroundColor = noteColors[Math.floor(Math.random() * noteColors.length)];
            note.style.transform = `rotate(${(Math.random() * 8) - 4}deg)`;
            
            document.getElementById('pledge-wall').appendChild(note);
            pledgeInput.value = "";
            pledgeInput.focus();
        }

        // ===== EVENT LISTENERS =====
        document.getElementById('prev-page-btn').addEventListener('click', () => {
            if (currentSpreadIndex > 0) {
                currentSpreadIndex--;
                showSpread(currentSpreadIndex);
            }
        });

        document.getElementById('next-page-btn').addEventListener('click', () => {
            const spreads = document.querySelectorAll('.spread');
            if (currentSpreadIndex < spreads.length - 1) {
                currentSpreadIndex++;
                showSpread(currentSpreadIndex);
            }
        });

        document.getElementById('mute-toggle-btn').addEventListener('click', () => {
            isMuted = !isMuted;
            currentAudio.muted = isMuted;
            document.getElementById('mute-toggle-btn').textContent = isMuted ? 'üîá' : 'üîä';
        });

        document.getElementById('fullscreen-button').addEventListener('click', () => {
            const elem = document.documentElement;
            if (!document.fullscreenElement) {
                elem.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        });

        currentAudio.addEventListener('ended', () => {
            currentTrackIndex++;
            playNextInPlaylist();
        });

        currentAudio.addEventListener('error', () => {
            console.error('Error playing audio file:', currentAudio.src);
            currentTrackIndex++;
            playNextInPlaylist();
        });

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            createSpreads();
        });
    </script>

</body>
</html>
